var BMapLib=window.BMapLib=BMapLib||{};!function(){function n(n,t){var r=e(n),i=new BMap.Polyline(r,t);return i.addEventListener("lineupdate",function(){this.isEditing&&this.enableEditing()}),i.cornerPoints=n,i.editMarkers=[],i.enableEditing=function(){var n=this;if(n.map){n.disableEditing();for(var t=0;t<n.cornerPoints.length;t++){var r=new BMap.Marker(n.cornerPoints[t],{icon:new BMap.Icon("http://api.map.baidu.com/library/CurveLine/1.5/src/circle.png",new BMap.Size(16,16)),enableDragging:!0,raiseOnDrag:!0});r.addEventListener("dragend",function(){n.cornerPoints.length=0;for(var t=0;t<n.editMarkers.length;t++)n.cornerPoints.push(n.editMarkers[t].getPosition());var r=e(n.cornerPoints);n.setPath(r)}),r.index=t,n.editMarkers.push(r),n.map.addOverlay(r)}}n.isEditing=!0},i.disableEditing=function(){this.isEditing=!1;for(var n=0;n<this.editMarkers.length;n++)this.map.removeOverlay(this.editMarkers[n]),this.editMarkers[n]=null;this.editMarkers.length=0},i.getPath=function(){return this.points},i}function e(n){for(var e=[],r=0;r<n.length-1;r++){var i=t(n[r],n[r+1]);i&&i.length>0&&(e=e.concat(i))}return e}function t(n,e){if(!(n&&e&&n instanceof BMap.Point&&e instanceof BMap.Point))return null;var t=function(n){return 1-2*n+n*n},r=function(n){return 2*n-2*n*n},i=function(n){return n*n};curveCoordinates=[];var a,o,s,d,u,l,c,p=30,h=0,f=0;if("undefined"==typeof e)return void("undefined"!=typeof curveCoordinates&&(curveCoordinates=[]));var v=parseFloat(n.lat),M=parseFloat(e.lat),g=parseFloat(n.lng),P=parseFloat(e.lng);for(P>g&&parseFloat(P-g)>180&&0>g&&(g=parseFloat(360+g)),g>P&&parseFloat(g-P)>180&&0>P&&(P=parseFloat(360+P)),l=0,c=0,M==v?(a=0,o=g-P):P==g?(a=Math.PI/2,o=v-M):(a=Math.atan((M-v)/(P-g)),o=(M-v)/Math.sin(a)),0==c&&(c=a+Math.PI/5),s=o/2,u=s*Math.cos(c)+g,d=s*Math.sin(c)+v,h=0;p+1>h;h++)curveCoordinates.push(new BMap.Point(g*t(f)+u*r(f)+P*i(f),v*t(f)+d*r(f)+M*i(f))),f+=1/p;return curveCoordinates}BMapLib.CurveLine=n}();