<extend name="layout:weui"/>
<block name="css">
  {:css('-simple-line-icons')}
  {:css('-jquery-weui.min')}
  {:css('-huzhu')}
</block>

<block name="content">




  <div class="weui_tab">
    <div class="weui_tab_bd">

      <!-- Page 1: Everybody's needs -->
      <div id="tab-all-needs" class="weui_tab_bd_item weui_tab_bd_item_active">
        <div id="needs-filters">

          <!-- need filters -->
          <div class="weui-row">
            <div class="weui-col-33"><div class="select-box"><input type="text" id="city-picker" value="深圳"/><i class="icons icon-arrow-down"></i></div></div>
            <div class="weui-col-33"><div class="select-box"><input type="text" id="category-selector" value="全部类型"/><i class="icons icon-arrow-down"></i></div></div>
            <div class="weui-col-33"><div class="select-box"><input type="text" id="progress-selector" value="新出现"/><i class="icons icon-arrow-down"></i></div></div>
          </div>

          <!-- we-ui search bar -->
          <div class="weui_search_bar" id="search_bar">
            <form class="weui_search_outer">
              <div class="weui_search_inner">
                <i class="weui_icon_search"></i>
                <input type="search" class="weui_search_input" id="search_input" placeholder="搜索" required/>
                <a href="javascript:" class="weui_icon_clear" id="search_clear"></a>
              </div>
              <label for="search_input" class="weui_search_text" id="search_text">
                <i class="weui_icon_search"></i>
                <span>搜索</span>
              </label>
            </form>
            <a href="javascript:" class="weui_search_cancel" id="search_cancel">取消</a>
          </div> <!-- search bar -->
        </div>
        <!-- needs list -->
        <div id="needs-list" class="weui-row main-scroll-view" data-bind="foreach: wishes">
          <div class="weui-col-50 wish-item" data-bind="click: $parent.showDetail">
            <h2 data-bind="text: content"></h2>
            <div class="publisher" data-bind="text: author"></div>
            <div class="count-groups">
              <i class="icons icon-heart"></i><span class="like-count" data-bind="text: likes"></span>
              <i class="icons icon-action-undo"></i><span class="reply-count" data-bind="text: replies"></span>
            </div>
          </div>
        </div>
      </div> <!-- tab 1 -->

      <!-- Page2: add needs -->
      <div id="tab-create-need" class="weui_tab_bd_item">
        <div class="weui_cells weui_cells_form">
          <div class="weui_cell">
            <div class="weui_cell_hd"><label class="weui_label">发布机构</label></div>
            <div class="weui_cell_bd weui_cell_primary">
              <span class="add-user-name">长沙市雨花区益家公益文化促进中心</span>
              <div class="change-user"><a class="weui_btn weui_btn_mini weui_btn_default" id="change-user-button">更换用户</a></div>
            </div>
          </div>
        </div>
        <div class="weui_cells_title">心愿内容</div>
        <div class="weui_cells weui_cells_form">
          <div class="weui_cell">
            <div class="weui_cell_bd weui_cell_primary">
              <textarea class="weui_textarea" placeholder="请输入评论" rows="3" id="input-create-content"></textarea>
              <div class="weui_textarea_counter"><span>0</span>/200</div>
            </div>
          </div>
          <div class="weui_cell">
            <div class="weui_cell_hd"><label class="weui_label">需求分类</label></div>
            <div class="weui_cell_bd weui_cell_primary">
              <input id="create-need-type" class="weui_input" type="tel" placeholder="场地">
            </div>
          </div>
          <div class="weui_cell">
            <div class="weui_cell_hd"><label class="weui_label">有效期至</label></div>
            <div class="weui_cell_bd weui_cell_primary">
              <input id="create-exp-date" data-toggle='date' value="{:date('Y-m-d')}" class="weui_input" placeholder="">
            </div>
          </div>
        </div> <!-- weui_cells -->

        <a href="javascript:;" class="weui_btn weui_btn_primary action_button_primary" id="publish-huzhu-button">发布心愿</a>
      </div>

      <!-- Page3: My Needs -->
      <div id="tab-my-needs" class="weui_tab_bd_item">
        <!-- need filters -->
        <div class="weui-row">
          <div class="weui-col-33"></div><div class="weui-col-33"></div>
          <div class="weui-col-33"><div class="select-box"><input type="text" id="my-filter-selector" value="未读" data-values="unread"/><i class="icons icon-arrow-down"></i></div></div>
        </div>

        <!-- needs list -->
        <div class="weui-row main-scroll-view" data-bind="foreach: wishes">
          <div class="weui-col-50 wish-item" data-bind="click: $parent.showDetail">
            <h2 data-bind="text: content"></h2>
            <div class="publisher" data-bind="text: author"></div>
            <div class="count-groups">
              <i class="icons icon-heart"></i><span class="like-count" data-bind="text: likes"></span>
              <i class="icons icon-action-undo"></i><span class="reply-count" data-bind="text: replies"></span>
            </div>
          </div>
        </div>
      </div> <!-- tab-3 -->
    </div>
    <div class="weui_tabbar">
      <a href="#tab-all-needs" class="weui_tabbar_item weui_bar_item_on" onclick="loadWishesList()">
        <div class="weui_tabbar_icon">
          <i class="icon-people icons" style="color: #2ecc71;"></i>
        </div>
        <p class="weui_tabbar_label">大家的心愿</p>
      </a>
      <a href="#tab-create-need" class="weui_tabbar_item">
        <div class="weui_tabbar_icon">
          <i class="icon-plus icons" style="color: #e74c3c;"></i>
        </div>
        <p class="weui_tabbar_label">发布心愿</p>
      </a>
      <a href="#tab-my-needs" class="weui_tabbar_item" onclick="loadMyWishesList()">
        <div class="weui_tabbar_icon">
          <i class="icon-user icons" style="color: #9b59b6;"></i>
        </div>
        <p class="weui_tabbar_label">我的心愿</p>
      </a>
    </div>
  </div>

  <div id="connect-account-popup" class="weui-popup-container">
    <div class="weui-popup-modal">
      <div class="weui_cells_title">发布心愿需要关联公益地图上的机构信息。请登录公益地图账号</div>
      <div class="weui_cells weui_cells_form">
        <div class="weui_cell">
          <div class="weui_cell_hd"><label class="weui_label">登录邮箱</label></div>
          <div class="weui_cell_bd weui_cell_primary">
            <input class="weui_input" type="email" placeholder="example@qq.com">
          </div>
        </div>
        <div class="weui_cell">
          <div class="weui_cell_hd"><label class="weui_label">密码</label></div>
          <div class="weui_cell_bd weui_cell_primary">
            <input class="weui_input" type="password">
          </div>
        </div>
      </div> <!-- weui_cells -->
      <a class="weui_btn weui_btn_mini weui_btn_default register-now-button">没有公益地图账号？现在注册</a>
      <div class="action_button_primary link-account-buttons">
        <a href="javascript:;" class="weui_btn weui_btn_default close-popup">取消</a>
        <a href="javascript:;" class="weui_btn weui_btn_primary">下一步</a>
      </div>
    </div>
  </div> <!-- Dialog: connect-account-popup -->

  <div id="publish-success-popup" class="weui-popup-container">
    <div class="weui-popup-modal">
      <div class="weui_msg">
        <div class="weui_icon_area"><i class="weui_icon_success weui_icon_msg"></i></div>
        <div class="weui_text_area">
          <h2 class="weui_msg_title">成功发布心愿</h2>
          <p class="weui_msg_desc">点击确定回到心愿列表</p>
        </div>
        <div class="weui_opr_area">
          <p class="weui_btn_area">
            <a href="javascript:;" class="weui_btn weui_btn_primary close-popup">确定</a>
          </p>
        </div>
        <div class="weui_extra_area">
          <a href="">查看刚刚发布的心愿</a>
        </div>
      </div>
    </div>
  </div>

  <div id="edit-wish-popup" class="weui-popup-container">
    <div class="weui-popup-modal">
      <div class="weui_cells_title">心愿内容</div>
      <div class="weui_cells weui_cells_form">
        <div class="weui_cell">
          <div class="weui_cell_bd weui_cell_primary">
            <textarea class="weui_textarea" placeholder="请输入评论" rows="3" id="input-edit-content" data-bind="value: content"></textarea>
            <div class="weui_textarea_counter"><span>0</span>/200</div>
          </div>
        </div>
        <div class="weui_cell">
          <div class="weui_cell_hd"><label class="weui_label">需求分类</label></div>
          <div class="weui_cell_bd weui_cell_primary">
            <input id="edit-need-type" class="weui_input" type="tel" placeholder="场地" data-bind="value: category">
          </div>
        </div>
        <div class="weui_cell">
          <div class="weui_cell_hd"><label class="weui_label">有效期至</label></div>
          <div class="weui_cell_bd weui_cell_primary">
            <input id="edit-exp-date" data-toggle='date' value="{:date('Y-m-d')}" class="weui_input" placeholder="" data-bind="value: expire_date">
          </div>
        </div>
      </div> <!-- weui_cells -->

      <a href="javascript:;" class="weui_btn weui_btn_primary action_button_primary" id="save-huzhu-button">保存</a>
      <a href="javascript:;" class="weui_btn weui_btn_default action_button_primary" id="return-to-huzhu-button" style="margin-right: 0;">返回</a>
    </div>
  </div>

  <div id="wish-detail-popup" class="weui-popup-container">
    <div class="weui-popup-modal">
      <div class="weui_tab">
        <div class="weui_tab_bd">
          <div class="wish-detail">
            <h2 data-bind="text: content"></h2>
            <div class="publisher" data-bind="text: author">长沙市雨花区益家公益文化促进中心</div>
            <div class="count-groups">
              <i class="icons icon-heart"></i><span class="like-count" data-bind="text: likes">50</span>
              <i class="icons icon-action-undo"></i><span class="reply-count" data-bind="text: replies">1</span>
            </div>
          </div>
          <h2 class="reply-title">回应</h2>
          <div class="post-replies" data-bind="foreach: replyList">
            <div class="post-reply">
              <div class="reply-author" data-bind="text: author"></div>
              <div class="time-frame">3天前</div>
              <div class="reply-content" data-bind="text: content"></div>
              <div class="reply-actions" data-bind="visible: window.account_id==account_id(), click: $parent.showReplyMenu">
                <i class="icons icon-options-vertical"></i>
              </div>
            </div>
          </div>
          <div class="add-reply" id="add-reply-form">
            <div class="weui_cells_title">添加回应</div>
            <div class="weui_cells weui_cells_form">
              <div class="weui_cell">
                <div class="weui_cell_bd weui_cell_primary">
                  <textarea class="weui_textarea" id="reply-content-input" placeholder="请输入回应" rows="3"></textarea>
                </div>
                <a href="javascript:;" class="weui_btn weui_btn_primary" id="post-reply-button">发布</a>
              </div>
            </div>
          </div>
        </div>
        <div class="weui_tabbar">
          <a href="javascript:;" class="weui_tabbar_item">
            <div class="weui_tabbar_icon">
              <i class="icon-arrow-left icons close-popup"></i>
            </div>
          </a>
          <a id="like-wish-button" href="javascript:;" class="weui_tabbar_item" data-bind="css: {liked: isLiked() != 0}">
            <div class="weui_tabbar_icon">
              <i class="icon-heart icons"></i>
            </div>
          </a>
          <a id="share-wish-button" href="javascript:;" class="weui_tabbar_item">
            <div class="weui_tabbar_icon">
              <i class="icon-share icons"></i>
            </div>
          </a>
          <a id="reply-nav-button" href="javascript:;" class="weui_tabbar_item">
            <div class="weui_tabbar_icon">
              <i class="icon-action-undo icons"></i>
            </div>
          </a>
          <a id="wish-action-button" href="javascript:;" class="weui_tabbar_item" data-bind="visible: window.account_id==account_id()">
            <div class="weui_tabbar_icon">
              <i class="icon-options icons"></i>
            </div>
          </a>
        </div>
      </div>
    </div>
  </div>

  <script>
  window.config_need_filter_types = [{title:"全部类型", value:""}, "需要场地", "需要技术支持", "需要志愿者"];
  window.config_need_types = ["需要场地", "需要技术支持", "需要志愿者"];
  window.config_progress_types = [{title:"新出现", value:""}, {title:"尚无回应", value:"noreply"}, {title:"已完成", value:"completed"}];
  window.config_mylist_types = [{title:"未读", value:"unread"}, {title:"我发起的", value:"my"}, {title:"我回应的", value:"replied"}, {title:"我关注的", value:"liked"}];
  window.account_id = {:user('account_id')};
  window.account_author_name = "{:user('name')}";
  </script>

  {:js('-jquery-1.11.1.min')}
  {:js('-jquery-weui.min')}
  {:js('-city-picker.min')}
  {:js('-knockout-2.2.1')}
  {:js('-knockout.mapping')}
  {:js('-huzhu-app')}
</block>
